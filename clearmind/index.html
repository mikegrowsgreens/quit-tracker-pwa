<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#0a0f0a">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="Clear Mind">
<meta name="description" content="Track your brain's recovery from cannabis with clinically sourced milestones, weighted scoring, and real-time progress visualization.">
<link rel="manifest" href="/manifest.json">
<link rel="apple-touch-icon" href="/icon-192.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;0,9..40,800&family=DM+Serif+Display&display=swap" rel="stylesheet">
<title>Clear Mind - Cannabis Recovery Tracker</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;-webkit-user-select:none;user-select:none;-webkit-touch-callout:none}
input,textarea{-webkit-user-select:text;user-select:text}
:root{
  --bg-deep:#060a06;--bg-surface:#0c1210;--bg-card:#111a16;--bg-card-hover:#162019;
  --border-subtle:rgba(163,230,53,0.06);--border-medium:rgba(163,230,53,0.12);--border-accent:rgba(163,230,53,0.25);
  --green-primary:#a3e635;--green-bright:#bef264;--green-muted:#65a30d;--green-dark:#365314;
  --purple:#a78bfa;--blue:#60a5fa;--amber:#fbbf24;--teal:#2dd4bf;--rose:#fb7185;--orange:#fb923c;
  --text-primary:#f1f5f9;--text-secondary:#94a3b8;--text-muted:#475569;--text-dim:#1e293b;
  --font-body:'DM Sans',sans-serif;--font-display:'DM Serif Display',serif;
  --radius-sm:8px;--radius-md:14px;--radius-lg:20px;--radius-xl:28px;
  --ease-out:cubic-bezier(0.16,1,0.3,1);--ease-spring:cubic-bezier(0.34,1.56,0.64,1);
}
body{font-family:var(--font-body);background:var(--bg-deep);color:var(--text-primary);min-height:100vh;min-height:100dvh;overflow-x:hidden;font-weight:400;letter-spacing:-0.01em;-webkit-font-smoothing:antialiased}
input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
input[type="number"]{-moz-appearance:textfield}
::-webkit-scrollbar{width:0}
button{font-family:var(--font-body)}

@keyframes fadeIn{from{opacity:0}to{opacity:1}}
@keyframes slideUp{from{transform:translateY(24px);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes slideDown{from{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}
@keyframes scaleIn{from{transform:scale(0.92);opacity:0}to{transform:scale(1);opacity:1}}
@keyframes pulseGlow{0%,100%{box-shadow:0 0 16px rgba(163,230,53,0.2)}50%{box-shadow:0 0 32px rgba(163,230,53,0.5),0 0 48px rgba(163,230,53,0.15)}}
@keyframes breatheRing{0%{r:42;opacity:0.3}50%{r:56;opacity:0.8}100%{r:42;opacity:0.3}}
@keyframes confettiFall{0%{transform:translateY(-10px) rotate(0deg) scale(1);opacity:1}80%{opacity:1}100%{transform:translateY(130px) rotate(720deg) scale(0.5);opacity:0}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
@keyframes shimmer{0%{background-position:-200% 0}100%{background-position:200% 0}}
@keyframes countPulse{0%,100%{transform:scale(1)}50%{transform:scale(1.08)}}
@keyframes ringDraw{from{stroke-dashoffset:var(--circ)}to{stroke-dashoffset:var(--offset)}}
.milestone-new{animation:pulseGlow 2s ease-in-out 3}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<script type="text/babel" data-type="module">
const { useState, useEffect, useRef, useCallback, useMemo } = React;

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// STORAGE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const Store = {
  _key: 'clearmind_data',
  get() { try { const d = localStorage.getItem(this._key); return d ? JSON.parse(d) : null } catch { return null } },
  save(data) { try { localStorage.setItem(this._key, JSON.stringify({ ...data, updatedAt: Date.now() })) } catch {} },
  clear() { localStorage.removeItem(this._key) },
  getSeen() { try { const d = localStorage.getItem('clearmind_seen'); return d ? JSON.parse(d) : [] } catch { return [] } },
  markSeen(label) { try { const s = this.getSeen(); if (!s.includes(label)) { s.push(label); localStorage.setItem('clearmind_seen', JSON.stringify(s)) } } catch {} },
  hasOnboarded() { return localStorage.getItem('clearmind_onboarded') === 'true' },
  setOnboarded() { localStorage.setItem('clearmind_onboarded', 'true') }
};

// ‚îÄ‚îÄ CRAVINGS LOG STORAGE ‚îÄ‚îÄ
const CravingStore = {
  _key: 'clearmind_cravings',
  getAll() { try { const d = localStorage.getItem(this._key); return d ? JSON.parse(d) : []; } catch { return []; } },
  add(entry) { try { const all = this.getAll(); all.unshift({ ...entry, id: Date.now(), timestamp: Date.now() }); localStorage.setItem(this._key, JSON.stringify(all)); } catch {} },
  clear() { localStorage.removeItem(this._key); }
};
function getCravingStats() {
  const all = CravingStore.getAll();
  if (all.length === 0) return null;
  const now = Date.now();
  const week = all.filter(c => now - c.timestamp < 7 * 86400000);
  const surfed = all.filter(c => c.outcome === 'surfed');
  const triggers = {};
  all.forEach(c => { (c.triggers || []).forEach(t => { triggers[t] = (triggers[t] || 0) + 1; }); });
  const topTriggers = Object.entries(triggers).sort((a, b) => b[1] - a[1]).slice(0, 3);
  const weekAvg = week.length > 0 ? Math.round((week.reduce((s, c) => s + (c.intensity || 5), 0) / week.length) * 10) / 10 : 0;
  return { total: all.length, thisWeek: week.length, surfedCount: surfed.length, surfedRate: all.length > 0 ? Math.round((surfed.length / all.length) * 100) : 0, topTriggers, weekAvgIntensity: weekAvg };
}


// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CONSTANTS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const H = 3600000, D = 86400000, Y = 365 * D;

const CRAVING_TRIGGERS = [
  { id: 'stress', label: 'Stress', icon: "\u{1F624}" },
  { id: 'boredom', label: 'Boredom', icon: "\u{1F611}" },
  { id: 'social', label: 'Social', icon: "\u{1F465}" },
  { id: 'routine', label: 'Routine', icon: "\u{1F504}" },
  { id: 'emotion', label: 'Emotion', icon: "\u{1F622}" },
  { id: 'sleep', label: 'Sleep', icon: "\u{1F319}" },
  { id: 'pain', label: 'Pain', icon: "\u26A1" },
  { id: 'anxiety', label: 'Anxiety', icon: "\u{1F630}" }
];
const CRAVING_ACHIEVEMENTS = [
  { count: 1, label: "First Wave", desc: "You logged your first craving. Awareness is power." },
  { count: 5, label: "Pattern Seeker", desc: "5 cravings logged. Patterns are emerging." },
  { count: 10, label: "Self-Aware", desc: "10 cravings tracked. You know yourself better than most." },
  { count: 25, label: "Wave Rider", desc: "25 cravings surfed and documented." },
  { count: 50, label: "Craving Whisperer", desc: "50 logged. Every one made you stronger." }
];


/*
 * CLEAR MIND v3 -- Cannabis Cessation Recovery Milestones
 * =======================================================
 * MILESTONE PHILOSOPHY: Front-loaded in first week when cravings peak
 * and dopamine is lowest. More frequent wins = stronger reinforcement.
 *
 * SCORING PHILOSOPHY: Recovery percentages use diminishing-returns
 * weighting. The massive healing in months 1-3 accounts for ~70-80%
 * of your score. Year 1-2 long-tail improvements add the remaining
 * 20-30%. This reflects clinical reality.
 *
 * Sources:
 *  Hirvonen et al. (2012) Molecular Psychiatry: CB1 receptor PET imaging
 *  D'Souza et al. (2016) Biological Psychiatry: CB1R rapid recovery
 *  Schuster et al. (2018) J Clinical Psychiatry: Memory recovery
 *  Hanson et al. (2010) Addictive Behaviors: 3-week cognitive recovery
 *  PMC clinical management review: Withdrawal onset/peak timelines
 *  Sleep Foundation / ScienceDirect: REM rebound, sleep normalization
 *  Recovery Research Institute: Cognitive recovery by day 25
 *
 * Last audited: February 2026
 */

const HEALTH_CATEGORIES = [
  { id: "endocannabinoid", label: "ECS Recovery", icon: "\uD83E\uDDE0", color: "#a3e635", weight: 0.25, milestones: [
    { time: 6*H, label: "THC metabolism accelerating", pct: 3, tip: "Your liver is actively breaking down stored THC. Stay hydrated to support the process." },
    { time: 12*H, label: "Blood THC levels dropping fast", pct: 8, tip: "THC half-life in blood is about 1.3 days for daily users." },
    { time: 24*H, label: "THC levels significantly reduced", pct: 15, tip: "Most acute THC effects have worn off. Your brain is noticing the change." },
    { time: 48*H, label: "CB1 receptors beginning to upregulate", pct: 28, tip: "PET scans show measurable receptor changes within 48 hours of cessation." },
    { time: 4*D, label: "Receptor recovery gaining momentum", pct: 40, tip: "Your endocannabinoid system is actively rebuilding. This is real progress." },
    { time: 7*D, label: "CB1 recovery accelerating", pct: 52, tip: "One week in. Receptor density is climbing back toward baseline." },
    { time: 14*D, label: "Receptor density approaching normal", pct: 68, tip: "D'Souza et al. found significant CB1R recovery by this point." },
    { time: 21*D, label: "Endocannabinoid tone stabilizing", pct: 80, tip: "Your natural endocannabinoid signaling is finding its rhythm again." },
    { time: 28*D, label: "CB1 receptors returned to normal density", pct: 92, tip: "Hirvonen's PET data: CB1 receptor density indistinguishable from non-users at 4 weeks." },
    { time: 90*D, label: "Endocannabinoid system fully recalibrated", pct: 100, tip: "Full system recalibration complete." }
  ]},
  { id: "cognitive", label: "Cognitive", icon: "\u26A1", color: "#a78bfa", weight: 0.25, milestones: [
    { time: 24*H, label: "Mental clarity beginning to shift", pct: 4, tip: "You may feel foggy. That's withdrawal, not permanent. It lifts." },
    { time: 48*H, label: "Processing speed starting to recover", pct: 10, tip: "Your brain is re-learning to function without THC dampening neural signals." },
    { time: 72*H, label: "THC fog beginning to lift", pct: 18, tip: "Peak withdrawal is passing. Many people notice the first moments of clarity here." },
    { time: 5*D, label: "Short-term memory improving", pct: 28, tip: "Schuster's research: memory improvements detectable within the first week." },
    { time: 7*D, label: "Verbal memory noticeably better", pct: 38, tip: "Your hippocampus is waking up. Word recall and conversation flow improving." },
    { time: 14*D, label: "Attention and focus sharpening", pct: 52, tip: "Sustained attention is recovering. Tasks that felt impossible are getting easier." },
    { time: 21*D, label: "Executive function normalizing", pct: 65, tip: "Planning, decision-making, impulse control are all rebuilding." },
    { time: 28*D, label: "Working memory approaching normal", pct: 78, tip: "Hanson et al: most cognitive deficits resolve by 3-4 weeks of abstinence." },
    { time: 60*D, label: "Full cognitive clarity restored", pct: 92, tip: "Recovery Research Institute: no significant cognitive deficits after 25+ days." },
    { time: 90*D, label: "Cognitive function at full capacity", pct: 100, tip: "Your mind is fully yours again." }
  ]},
  { id: "sleep", label: "Sleep Quality", icon: "\uD83C\uDF19", color: "#c084fc", weight: 0.20, milestones: [
    { time: 24*H, label: "Sleep disruption beginning", pct: 2, tip: "Expect difficulty falling asleep tonight. This is normal and temporary." },
    { time: 3*D, label: "REM rebound starting (vivid dreams)", pct: 8, tip: "Your brain is flooding with REM sleep it's been missing. Wild dreams are healing." },
    { time: 5*D, label: "Sleep onset slowly improving", pct: 15, tip: "It may still take longer to fall asleep, but total sleep time is increasing." },
    { time: 7*D, label: "Sleep duration stabilizing", pct: 24, tip: "Your circadian rhythm is beginning to recalibrate without THC." },
    { time: 14*D, label: "Total sleep time increasing", pct: 38, tip: "More time in restorative deep sleep and REM stages." },
    { time: 21*D, label: "Vivid dreams starting to fade", pct: 50, tip: "The REM rebound is settling. Dream intensity decreasing." },
    { time: 30*D, label: "Sleep architecture rebalancing", pct: 62, tip: "Your natural sleep cycles are rebuilding." },
    { time: 45*D, label: "Dream intensity normalizing", pct: 78, tip: "Sleep is feeling more restful. Fewer disruptions." },
    { time: 60*D, label: "Sleep quality approaching normal", pct: 92, tip: "Most sleep metrics are back to baseline." },
    { time: 90*D, label: "Full sleep restoration", pct: 100, tip: "Natural, restorative sleep is your new normal." }
  ]},
  { id: "mood", label: "Mood Stability", icon: "\uD83C\uDF1F", color: "#fbbf24", weight: 0.15, milestones: [
    { time: 12*H, label: "Irritability and restlessness starting", pct: 2, tip: "Mood changes are hitting. Your dopamine system is recalibrating." },
    { time: 24*H, label: "Anxiety may be peaking", pct: 5, tip: "Day one mood swings are real. They are temporary." },
    { time: 48*H, label: "Emotional intensity fluctuating", pct: 10, tip: "Tears, anger, joy, all amplified. You're feeling things that were muted." },
    { time: 72*H, label: "Acute irritability easing", pct: 18, tip: "The worst of the mood disruption is behind you." },
    { time: 7*D, label: "Anxiety beginning to settle", pct: 30, tip: "Your GABA/glutamate balance is normalizing." },
    { time: 14*D, label: "Mood swings decreasing", pct: 44, tip: "Emotional regulation is improving. Fewer sudden shifts." },
    { time: 21*D, label: "Emotional range returning", pct: 58, tip: "You're feeling the full spectrum again without the THC filter." },
    { time: 30*D, label: "Natural dopamine regulation improving", pct: 70, tip: "Your reward system is finding its natural set point." },
    { time: 60*D, label: "Emotional resilience strengthening", pct: 88, tip: "Handling stress with your own resources now." },
    { time: 90*D, label: "Mood stability fully restored", pct: 100, tip: "Full emotional recalibration. Natural emotional intelligence fully online." }
  ]},
  { id: "respiratory", label: "Lungs", icon: "\uD83E\uDEC1", color: "#2dd4bf", weight: 0.10, milestones: [
    { time: 24*H, label: "Bronchial irritation beginning to ease", pct: 5, tip: "Lungs are getting their first break." },
    { time: 48*H, label: "Airway inflammation reducing", pct: 12, tip: "Bronchial tubes are starting to relax." },
    { time: 7*D, label: "Cilia reactivating", pct: 22, tip: "Tiny hair-like structures in your lungs are waking up." },
    { time: 14*D, label: "Mucus clearance improving", pct: 32, tip: "You might cough more temporarily as lungs clean themselves." },
    { time: 30*D, label: "Lung capacity improving", pct: 48, tip: "Measurable improvements in how much air your lungs can hold." },
    { time: 90*D, label: "Chronic cough resolved", pct: 70, tip: "Breathing is noticeably easier." },
    { time: 180*D, label: "Airway inflammation healed", pct: 88, tip: "Deep tissue inflammation has resolved." },
    { time: Y, label: "Respiratory function fully restored", pct: 100, tip: "Your lungs are clean." }
  ]},
  { id: "appetite", label: "Appetite", icon: "\uD83C\uDF3F", color: "#fb923c", weight: 0.05, milestones: [
    { time: 12*H, label: "Appetite changes starting", pct: 5, tip: "Appetite may vanish. THC was driving hunger signals artificially." },
    { time: 24*H, label: "Nausea or reduced appetite", pct: 10, tip: "GI discomfort is common. Small, simple meals help." },
    { time: 3*D, label: "Appetite suppressed (withdrawal)", pct: 18, tip: "Peak appetite disruption. Your endocannabinoid system regulated your gut." },
    { time: 5*D, label: "First natural hunger signals", pct: 32, tip: "Real hunger is returning. Not THC-driven, but physiological need." },
    { time: 7*D, label: "Hunger patterns stabilizing", pct: 48, tip: "Your body is learning to regulate appetite on its own again." },
    { time: 14*D, label: "Eating patterns normalizing", pct: 68, tip: "Regular meals feel natural again." },
    { time: 21*D, label: "Digestion fully normalizing", pct: 85, tip: "GI system is running smoothly on its own chemistry." },
    { time: 30*D, label: "Appetite fully self-regulated", pct: 100, tip: "Natural hunger, natural fullness." }
  ]}
];

const ACHIEVEMENTS = [
  { time: H, label: "First Hour Clear", icon: "\u23F1", desc: "The journey of a thousand miles begins with a single step." },
  { time: 4*H, label: "Four Hours Strong", icon: "\uD83C\uDF31", desc: "Your body has already started metabolizing stored THC." },
  { time: 8*H, label: "Through the Night", icon: "\uD83C\uDF19", desc: "Eight hours without cannabis. That matters." },
  { time: 12*H, label: "Half Day", icon: "\uD83C\uDF1E", desc: "Cravings may be loud. You're louder." },
  { time: 18*H, label: "Mind Over Craving", icon: "\uD83E\uDDE0", desc: "Every craving you sit through weakens the next one." },
  { time: 24*H, label: "Day One Complete", icon: "\uD83C\uDF1F", desc: "A full day. You just did the hardest part." },
  { time: 36*H, label: "Day and a Half", icon: "\u2728", desc: "Your CB1 receptors are already beginning to wake up." },
  { time: 48*H, label: "Receptors Waking Up", icon: "\uD83E\uDDE0", desc: "Two days. Your brain is physically changing." },
  { time: 60*H, label: "Two and a Half Days", icon: "\uD83D\uDD25", desc: "Withdrawal symptoms are near their peak. Almost through the worst." },
  { time: 72*H, label: "Through the Peak", icon: "\u26A0", desc: "Three days. It genuinely gets easier from here." },
  { time: 4*D, label: "Four Days Free", icon: "\uD83D\uDCAA", desc: "The acute storm is calming." },
  { time: 5*D, label: "Five Days Strong", icon: "\uD83C\uDFAF", desc: "Cravings are weakening. Neurochemistry finding its feet." },
  { time: 6*D, label: "Almost a Week", icon: "\uD83C\uDF05", desc: "Tomorrow is a massive milestone." },
  { time: 7*D, label: "One Week", icon: "\uD83C\uDFC6", desc: "Memory improving. CB1 recovery accelerating. Landmark moment." },
  { time: 10*D, label: "Double Digits", icon: "\uD83D\uDD1F", desc: "Physical withdrawal is fading. New pathways forming." },
  { time: 14*D, label: "Two Weeks", icon: "\uD83C\uDFAF", desc: "Attention sharpening. Receptor density approaching normal." },
  { time: 21*D, label: "Three Weeks", icon: "\uD83C\uDFD4", desc: "Endocannabinoid tone stabilizing. Emotional range expanding." },
  { time: 28*D, label: "The Reset", icon: "\uD83E\uDDE0", desc: "CB1 receptors returned to normal density. The neurological reset is complete." },
  { time: 45*D, label: "Six Weeks", icon: "\uD83C\uDF3F", desc: "Brain fog fully lifted. Sleep normalizing. Clear thinking." },
  { time: 60*D, label: "Two Months", icon: "\uD83D\uDCC8", desc: "Working memory restored. New patterns are home." },
  { time: 90*D, label: "Quarter Year", icon: "\uD83C\uDFC6", desc: "Full cognitive and endocannabinoid recovery." },
  { time: 180*D, label: "Six Months", icon: "\uD83D\uDE80", desc: "Airway inflammation healed. Habits deeply rewired." },
  { time: Y, label: "One Year Free", icon: "\uD83D\uDC8E", desc: "Every system recalibrated. This is who you are." }
];

// Phase-based motivational content
const MOTIVATIONAL = {
  acute: [
    "The discomfort you feel right now is your brain healing. It is not a sign of weakness. It is a sign of repair.",
    "Every minute without cannabis is a minute your receptors are rebuilding. This is active healing.",
    "You are not depriving yourself. You are giving yourself back.",
    "The craving will pass whether you use or not. Choose the version of 'after' where you kept going."
  ],
  peak: [
    "Days 2-4 are the hardest for a reason. Your brain is doing the heaviest lifting right now.",
    "Withdrawal is temporary. The clarity on the other side is permanent.",
    "You are stronger than any craving. Every wave you ride makes the next one smaller.",
    "Right now your CB1 receptors are physically regenerating. You can't see it, but it's happening."
  ],
  recovery: [
    "You are past the peak. Every day from here is a little easier than the last.",
    "Your brain is rewiring in real time. The neural pathways that served addiction are weakening.",
    "Notice the small things returning. Sharper thoughts. Deeper sleep. Real laughter.",
    "You didn't just quit something. You started something."
  ],
  healing: [
    "Your neurological reset is nearly complete. What you've done takes real courage.",
    "The person you are becoming was always there, waiting underneath the fog.",
    "Your natural reward system is finding its set point. Joy from simple things is returning.",
    "You chose the harder path because you knew it led somewhere better."
  ],
  healed: [
    "Full recovery achieved. Your mind, body, and spirit are operating at their natural capacity.",
    "You did the work. You sat with the discomfort. You came out the other side whole.",
    "The clarity you have now was always yours. You just had to clear the way back to it.",
    "Remember what this took. Let it fuel everything you build from here."
  ]
};

// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// UTILITIES
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function getElapsed(qd) { return Date.now() - new Date(qd).getTime() }

function formatDuration(ms) {
  if (ms < 0) return "0s";
  const s = Math.floor(ms/1000), m = Math.floor(s/60), h = Math.floor(m/60), d = Math.floor(h/24), y = Math.floor(d/365);
  if (y > 0) return `${y}y ${d%365}d`;
  if (d > 0) return `${d}d ${h%24}h`;
  if (h > 0) return `${h}h ${m%60}m`;
  if (m > 0) return `${m}m ${s%60}s`;
  return `${s}s`;
}

function formatTime(ms) {
  const s = Math.floor(ms/1000), m = Math.floor(s/60), h = Math.floor(m/60), d = Math.floor(h/24);
  if (d > 365) { const y = Math.floor(d/365); return `${y} year${y>1?'s':''}`; }
  if (d > 0) return `${d} day${d>1?'s':''}`;
  if (h > 0) return `${h} hour${h>1?'s':''}`;
  return `${m} min`;
}

function formatRelativeTime(ts) {
  const diff = Date.now() - ts;
  if (diff < 60000) return 'just now';
  if (diff < 3600000) return `${Math.floor(diff/60000)}m ago`;
  if (diff < 86400000) return `${Math.floor(diff/3600000)}h ago`;
  if (diff < 7*86400000) return `${Math.floor(diff/86400000)}d ago`;
  return new Date(ts).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}


function getPhase(elapsed) {
  if (elapsed < 24*H) return 'acute';
  if (elapsed < 72*H) return 'peak';
  if (elapsed < 28*D) return 'recovery';
  if (elapsed < 90*D) return 'healing';
  return 'healed';
}

function getDailyMotivation(elapsed) {
  const phase = getPhase(elapsed);
  const msgs = MOTIVATIONAL[phase];
  const dayIndex = Math.floor(elapsed / D);
  return msgs[dayIndex % msgs.length];
}

function getContextualTip(elapsed) {
  if (elapsed < 6*H) return "The first hours are about breaking the pattern. Drink water, move your body, breathe deeply.";
  if (elapsed < 24*H) return "Cravings come in waves. They peak at 3-5 minutes then pass. You just have to ride them.";
  if (elapsed < 48*H) return "Day 1-2 is the hardest window for most people. Your brain is loudly protesting. Stay the course.";
  if (elapsed < 72*H) return "Withdrawal peaks between days 2-4. Irritability, insomnia, and appetite loss are normal. They fade.";
  if (elapsed < 5*D) return "The acute phase is winding down. Vivid dreams are your brain's REM rebound.";
  if (elapsed < 7*D) return "Almost a week. Your cognitive function is already measurably improving.";
  if (elapsed < 14*D) return "Week two. Cravings are less frequent. Receptor recovery is accelerating.";
  if (elapsed < 21*D) return "Your endocannabinoid system is finding its natural balance. Emotional range expanding.";
  if (elapsed < 28*D) return "Approaching the 28-day CB1 reset. Nearly back to natural receptor density.";
  if (elapsed < 60*D) return "The neurological reset is complete. Building new patterns and protecting your clarity.";
  if (elapsed < 90*D) return "Deep recovery territory. Cognitive function at full capacity. Your brain is yours again.";
  return "Full recovery achieved. Every system recalibrated. You chose clarity and it chose you back.";
}

function getCategoryProgress(cat, elapsed) {
  let progress = 0, currentLabel = "Not started", currentTip = "", nextLabel = cat.milestones[0]?.label || "", nextTime = cat.milestones[0]?.time || 0;
  for (let i = 0; i < cat.milestones.length; i++) {
    const m = cat.milestones[i];
    if (elapsed >= m.time) {
      progress = m.pct; currentLabel = m.label; currentTip = m.tip || "";
      if (i + 1 < cat.milestones.length) {
        const next = cat.milestones[i + 1];
        const segElapsed = elapsed - m.time;
        const segTotal = next.time - m.time;
        const segProgress = Math.min(segElapsed / segTotal, 1);
        const eased = 1 - Math.pow(1 - segProgress, 2);
        progress = m.pct + eased * (next.pct - m.pct);
        nextLabel = next.label; nextTime = next.time;
      } else { nextLabel = ""; nextTime = 0; }
    }
  }
  if (elapsed < (cat.milestones[0]?.time || 0)) {
    const f = cat.milestones[0];
    progress = (elapsed / f.time) * f.pct;
    currentLabel = "Recovery beginning"; currentTip = f.tip || "";
  }
  return { progress: Math.min(progress, 100), currentLabel, currentTip, nextLabel, nextTime };
}

function getWeightedHealth(elapsed) {
  return HEALTH_CATEGORIES.reduce((t, c) => t + getCategoryProgress(c, elapsed).progress * c.weight, 0);
}


// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// REUSABLE COMPONENTS
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

function Confetti({ active }) {
  if (!active) return null;
  const colors = ['#a3e635','#22c55e','#4ade80','#fbbf24','#a78bfa','#c084fc','#2dd4bf','#fb923c'];
  const particles = Array.from({ length: 40 }, (_, i) => ({
    id: i, left: Math.random() * 100, delay: Math.random() * 2,
    color: colors[i % colors.length], size: 3 + Math.random() * 7,
    duration: 1.8 + Math.random() * 1.5, shape: Math.random() > 0.5 ? '50%' : '2px'
  }));
  return (
    <div style={{ position:'fixed', inset:0, pointerEvents:'none', zIndex:200, overflow:'hidden' }}>
      {particles.map(p => (
        <div key={p.id} style={{
          position:'absolute', left:`${p.left}%`, top:0, width:p.size, height:p.size,
          background:p.color, borderRadius:p.shape,
          animation: `confettiFall ${p.duration}s ease-out ${p.delay}s forwards`
        }} />
      ))}
    </div>
  );
}

function ProgressRing({ progress, color, size = 100, strokeWidth = 8, animated = true, children }) {
  const r = (size - strokeWidth) / 2;
  const circ = 2 * Math.PI * r;
  const offset = circ - (progress / 100) * circ;
  return (
    <div style={{ position:'relative', width:size, height:size }}>
      <svg width={size} height={size} style={{ transform:'rotate(-90deg)' }}>
        <circle cx={size/2} cy={size/2} r={r} fill="none" stroke="rgba(255,255,255,0.04)" strokeWidth={strokeWidth} />
        <circle cx={size/2} cy={size/2} r={r} fill="none" stroke={color} strokeWidth={strokeWidth}
          strokeDasharray={circ} strokeDashoffset={offset} strokeLinecap="round"
          style={animated ? {
            '--circ': circ, '--offset': offset,
            animation: 'ringDraw 1.2s var(--ease-out) forwards',
            transition: 'stroke-dashoffset 1s var(--ease-out)'
          } : { transition: 'stroke-dashoffset 1s var(--ease-out)' }}
        />
      </svg>
      <div style={{ position:'absolute', inset:0, display:'flex', alignItems:'center', justifyContent:'center', flexDirection:'column' }}>
        {children}
      </div>
    </div>
  );
}


// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// BREATHING EXERCISE (Emergency Craving Tool)
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function BreathingExercise({ onClose, onLogCraving }) {
  const [phase, setPhase] = useState('idle'); // idle, inhale, hold, exhale, done
  const [cycle, setCycle] = useState(0);
  const [seconds, setSeconds] = useState(0);
  const totalCycles = 4;
  const timerRef = useRef(null);

  const phases = { inhale: 4, hold: 4, exhale: 6 };

  useEffect(() => {
    if (phase === 'idle' || phase === 'done') return;
    const duration = phases[phase];
    setSeconds(duration);
    timerRef.current = setInterval(() => {
      setSeconds(prev => {
        if (prev <= 1) {
          clearInterval(timerRef.current);
          if (phase === 'inhale') setPhase('hold');
          else if (phase === 'hold') setPhase('exhale');
          else if (phase === 'exhale') {
            if (cycle + 1 >= totalCycles) setPhase('done');
            else { setCycle(c => c + 1); setPhase('inhale'); }
          }
          return 0;
        }
        return prev - 1;
      });
    }, 1000);
    return () => clearInterval(timerRef.current);
  }, [phase, cycle]);

  const ringProgress = phase === 'idle' ? 0 : phase === 'done' ? 100 :
    ((phases[phase] - seconds) / phases[phase]) * 100;

  const phaseColor = phase === 'inhale' ? '#a3e635' : phase === 'hold' ? '#fbbf24' : phase === 'exhale' ? '#a78bfa' : '#2dd4bf';
  const phaseLabel = phase === 'idle' ? 'Ready' : phase === 'done' ? 'Complete' :
    phase === 'inhale' ? 'Breathe In' : phase === 'hold' ? 'Hold' : 'Breathe Out';

  return (
    <div onClick={onClose} style={{
      position:'fixed', inset:0, background:'rgba(0,0,0,0.92)', zIndex:100,
      display:'flex', alignItems:'center', justifyContent:'center',
      backdropFilter:'blur(20px)', animation:'fadeIn 0.3s ease-out'
    }}>
      <div onClick={e => e.stopPropagation()} style={{
        display:'flex', flexDirection:'column', alignItems:'center', gap:32,
        padding:40, animation:'scaleIn 0.4s var(--ease-spring)'
      }}>
        <div style={{ textAlign:'center' }}>
          <h2 style={{ fontFamily:'var(--font-display)', fontSize:24, color:'var(--text-primary)', marginBottom:4 }}>
            {phase === 'done' ? 'You made it.' : 'Ride the Wave'}
          </h2>
          <p style={{ fontSize:13, color:'var(--text-secondary)' }}>
            {phase === 'done' ? 'The craving has passed. You are still here.' : '4-4-6 breathing to calm your nervous system'}
          </p>
        </div>

        <div style={{ position:'relative' }}>
          <ProgressRing progress={ringProgress} color={phaseColor} size={180} strokeWidth={6} animated={false}>
            <span style={{
              fontSize:48, fontWeight:300, color:phaseColor, fontFamily:'var(--font-display)',
              animation: seconds > 0 ? 'countPulse 1s ease-in-out infinite' : 'none'
            }}>
              {phase === 'idle' ? '' : phase === 'done' ? '\u2713' : seconds}
            </span>
            <span style={{ fontSize:14, fontWeight:600, color:'var(--text-secondary)', marginTop:4, letterSpacing:1, textTransform:'uppercase' }}>
              {phaseLabel}
            </span>
          </ProgressRing>
          {phase !== 'idle' && phase !== 'done' && (
            <svg width={180} height={180} style={{ position:'absolute', top:0, left:0, transform:'rotate(-90deg)' }}>
              <circle cx={90} cy={90} r={87} fill="none" stroke={phaseColor} strokeWidth={1} opacity={0.15}
                style={{ animation: 'breatheRing 4s ease-in-out infinite' }}
              />
            </svg>
          )}
        </div>

        {phase !== 'done' && (
          <div style={{ display:'flex', gap:8 }}>
            {Array.from({ length: totalCycles }, (_, i) => (
              <div key={i} style={{
                width:8, height:8, borderRadius:'50%',
                background: i < cycle ? '#a3e635' : i === cycle && phase !== 'idle' ? phaseColor : 'rgba(255,255,255,0.1)',
                transition:'all 0.3s'
              }} />
            ))}
          </div>
        )}

        {phase === 'idle' ? (
          <button onClick={() => setPhase('inhale')} style={{
            padding:'14px 48px', borderRadius:40, border:'none', cursor:'pointer',
            fontSize:15, fontWeight:700, fontFamily:'var(--font-body)',
            background:'linear-gradient(135deg, #a3e635, #65a30d)', color:'#0a0f0a',
            transition:'transform 0.2s'
          }}>Start Breathing</button>
        ) : phase === 'done' ? (
          <div style={{ display:'flex', flexDirection:'column', gap:12, alignItems:'center' }}>
            <button onClick={() => { onLogCraving && onLogCraving(true); onClose(); }} style={{
              padding:'14px 48px', borderRadius:40, border:'none', cursor:'pointer',
              fontSize:15, fontWeight:700, fontFamily:'var(--font-body)',
              background:'linear-gradient(135deg, #a3e635, #65a30d)', color:'#0a0f0a'
            }}>Log This Craving</button>
            <button onClick={onClose} style={{
              padding:'10px 32px', borderRadius:40, border:'1px solid var(--border-medium)',
              cursor:'pointer', fontSize:13, fontWeight:600, fontFamily:'var(--font-body)',
              background:'transparent', color:'var(--text-secondary)'
            }}>I'm Good</button>
          </div>
        ) : null}

        <button onClick={onClose} style={{
          background:'none', border:'none', color:'var(--text-muted)', fontSize:13, cursor:'pointer',
          fontFamily:'var(--font-body)', padding:8
        }}>close</button>
      </div>
    </div>
  );
}


// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// ONBOARDING
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

// ‚îÄ‚îÄ CRAVING LOG MODAL ‚îÄ‚îÄ
function CravingLogModal({ onClose, onSave, prefillBreathing }) {
  const [intensity, setIntensity] = useState(5);
  const [triggers, setTriggers] = useState([]);
  const [note, setNote] = useState('');
  const [usedBreathing, setUsedBreathing] = useState(prefillBreathing || false);
  const [outcome, setOutcome] = useState('surfed');
  const [saved, setSaved] = useState(false);
  const toggleTrigger = (id) => setTriggers(prev => prev.includes(id) ? prev.filter(t => t !== id) : [...prev, id]);
  const handleSave = () => {
    onSave({ intensity, triggers, note, usedBreathing, outcome });
    setSaved(true);
    setTimeout(onClose, 1200);
  };
  if (saved) return (
    <div style={{ position:'fixed', inset:0, background:'rgba(0,0,0,0.92)', zIndex:100, display:'flex', alignItems:'center', justifyContent:'center', backdropFilter:'blur(20px)', animation:'fadeIn 0.2s ease-out' }}>
      <div style={{ textAlign:'center', animation:'scaleIn 0.4s var(--ease-spring)' }}>
        <div style={{ fontSize:64, marginBottom:16 }}>üåä</div>
        <h2 style={{ fontFamily:'var(--font-display)', fontSize:22, color:'#a3e635' }}>
          {outcome === 'surfed' ? 'Wave surfed.' : 'Logged.'}
        </h2>
        <p style={{ fontSize:13, color:'var(--text-secondary)', marginTop:8 }}>
          {outcome === 'surfed' ? 'Every one you ride makes the next one smaller.' : 'Honesty is the foundation of recovery. Keep going.'}
        </p>
      </div>
    </div>
  );
  return (
    <div onClick={onClose} style={{ position:'fixed', inset:0, background:'rgba(0,0,0,0.85)', zIndex:100, display:'flex', alignItems:'flex-end', justifyContent:'center', backdropFilter:'blur(12px)', animation:'fadeIn 0.2s ease-out' }}>
      <div onClick={e => e.stopPropagation()} style={{ background:'var(--bg-card)', borderRadius:'var(--radius-xl) var(--radius-xl) 0 0', padding:'24px 20px 36px', width:'100%', maxWidth:440, maxHeight:'88vh', overflowY:'auto', animation:'slideUp 0.3s var(--ease-out)' }}>
        <div style={{ display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:20 }}>
          <h3 style={{ fontFamily:'var(--font-display)', fontSize:20, color:'var(--text-primary)' }}>Log Craving</h3>
          <button onClick={onClose} style={{ background:'rgba(255,255,255,0.06)', border:'none', color:'var(--text-secondary)', width:36, height:36, borderRadius:'50%', cursor:'pointer', fontSize:18 }}>√ó</button>
        </div>
        <div style={{ marginBottom:20 }}>
          <div style={{ display:'flex', justifyContent:'space-between', alignItems:'baseline', marginBottom:10 }}>
            <label style={{ fontSize:12, color:'var(--text-secondary)', fontWeight:600, letterSpacing:0.3, textTransform:'uppercase' }}>Intensity</label>
            <span style={{ fontSize:28, fontWeight:300, color: intensity <= 3 ? '#a3e635' : intensity <= 6 ? '#fbbf24' : '#fb7185', fontFamily:'var(--font-display)' }}>{intensity}</span>
          </div>
          <div style={{ display:'flex', gap:4 }}>
            {[1,2,3,4,5,6,7,8,9,10].map(n => (
              <button key={n} onClick={() => setIntensity(n)} style={{
                flex:1, height:36, borderRadius:'var(--radius-sm)', border:'none', cursor:'pointer',
                background: n <= intensity ? (n <= 3 ? 'rgba(163,230,53,0.25)' : n <= 6 ? 'rgba(251,191,36,0.25)' : 'rgba(251,113,133,0.25)') : 'rgba(255,255,255,0.04)',
                color: n <= intensity ? 'var(--text-primary)' : 'var(--text-muted)',
                fontSize:11, fontWeight:700, fontFamily:'var(--font-body)', transition:'all 0.15s'
              }}>{n}</button>
            ))}
          </div>
          <div style={{ display:'flex', justifyContent:'space-between', marginTop:4 }}>
            <span style={{ fontSize:9, color:'var(--text-muted)' }}>Mild</span>
            <span style={{ fontSize:9, color:'var(--text-muted)' }}>Intense</span>
          </div>
        </div>
        <div style={{ marginBottom:20 }}>
          <label style={{ fontSize:12, color:'var(--text-secondary)', fontWeight:600, letterSpacing:0.3, textTransform:'uppercase', display:'block', marginBottom:10 }}>What triggered it?</label>
          <div style={{ display:'flex', flexWrap:'wrap', gap:8 }}>
            {CRAVING_TRIGGERS.map(t => {
              const active = triggers.includes(t.id);
              return (
                <button key={t.id} onClick={() => toggleTrigger(t.id)} style={{
                  padding:'8px 14px', borderRadius:20,
                  border: active ? '1px solid #a3e635' : '1px solid var(--border-subtle)',
                  background: active ? 'rgba(163,230,53,0.1)' : 'transparent',
                  color: active ? '#a3e635' : 'var(--text-muted)',
                  fontSize:12, fontWeight:600, cursor:'pointer', fontFamily:'var(--font-body)',
                  transition:'all 0.15s', display:'flex', alignItems:'center', gap:5
                }}>
                  <span style={{ fontSize:14 }}>{t.icon}</span> {t.label}
                </button>
              );
            })}
          </div>
        </div>
        <div style={{ marginBottom:20 }}>
          <label style={{ fontSize:12, color:'var(--text-secondary)', fontWeight:600, letterSpacing:0.3, textTransform:'uppercase', display:'block', marginBottom:10 }}>Used breathing exercise?</label>
          <div style={{ display:'flex', gap:8 }}>
            {[{ val: true, label: 'Yes' }, { val: false, label: 'No' }].map(opt => (
              <button key={String(opt.val)} onClick={() => setUsedBreathing(opt.val)} style={{
                flex:1, padding:'12px', borderRadius:'var(--radius-md)',
                border: usedBreathing === opt.val ? '1px solid #a3e635' : '1px solid var(--border-subtle)',
                background: usedBreathing === opt.val ? 'rgba(163,230,53,0.08)' : 'transparent',
                color: usedBreathing === opt.val ? '#a3e635' : 'var(--text-muted)',
                fontSize:13, fontWeight:600, cursor:'pointer', fontFamily:'var(--font-body)', transition:'all 0.2s'
              }}>{opt.label}</button>
            ))}
          </div>
        </div>
        <div style={{ marginBottom:20 }}>
          <label style={{ fontSize:12, color:'var(--text-secondary)', fontWeight:600, letterSpacing:0.3, textTransform:'uppercase', display:'block', marginBottom:10 }}>Outcome</label>
          <div style={{ display:'flex', gap:8 }}>
            <button onClick={() => setOutcome('surfed')} style={{ flex:1, padding:'14px 12px', borderRadius:'var(--radius-md)', border: outcome === 'surfed' ? '1px solid #a3e635' : '1px solid var(--border-subtle)', background: outcome === 'surfed' ? 'rgba(163,230,53,0.08)' : 'transparent', color: outcome === 'surfed' ? '#a3e635' : 'var(--text-muted)', fontSize:13, fontWeight:600, cursor:'pointer', fontFamily:'var(--font-body)', transition:'all 0.2s', textAlign:'center' }}>
              <div style={{ fontSize:20, marginBottom:4 }}>üåä</div>Rode it out
            </button>
            <button onClick={() => setOutcome('slipped')} style={{ flex:1, padding:'14px 12px', borderRadius:'var(--radius-md)', border: outcome === 'slipped' ? '1px solid var(--rose)' : '1px solid var(--border-subtle)', background: outcome === 'slipped' ? 'rgba(251,113,133,0.08)' : 'transparent', color: outcome === 'slipped' ? 'var(--rose)' : 'var(--text-muted)', fontSize:13, fontWeight:600, cursor:'pointer', fontFamily:'var(--font-body)', transition:'all 0.2s', textAlign:'center' }}>
              <div style={{ fontSize:20, marginBottom:4 }}>üìù</div>Slipped
            </button>
          </div>
        </div>
        <div style={{ marginBottom:24 }}>
          <label style={{ fontSize:12, color:'var(--text-secondary)', fontWeight:600, letterSpacing:0.3, textTransform:'uppercase', display:'block', marginBottom:8 }}>Note (optional)</label>
          <textarea value={note} onChange={e => setNote(e.target.value)} placeholder="What was happening? How did you feel?" rows={2}
            style={{ width:'100%', padding:'12px 14px', borderRadius:'var(--radius-md)', background:'rgba(255,255,255,0.04)', border:'1px solid var(--border-medium)', color:'var(--text-primary)', fontSize:14, outline:'none', fontFamily:'var(--font-body)', resize:'none', lineHeight:1.5, boxSizing:'border-box' }} />
        </div>
        <button onClick={handleSave} style={{ width:'100%', padding:'16px', borderRadius:40, border:'none', cursor:'pointer', fontSize:16, fontWeight:700, fontFamily:'var(--font-body)', background:'linear-gradient(135deg, #a3e635, #65a30d)', color:'#0a0f0a' }}>Save</button>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ CRAVINGS TAB VIEW ‚îÄ‚îÄ
function CravingsTab({ onOpenLog }) {
  const [cravings, setCravings] = useState(() => CravingStore.getAll());
  const [stats, setStats] = useState(() => getCravingStats());
  useEffect(() => { const iv = setInterval(() => { setCravings(CravingStore.getAll()); setStats(getCravingStats()); }, 2000); return () => clearInterval(iv); }, []);

  if (!stats || stats.total === 0) return (
    <div style={{ textAlign:'center', padding:'40px 20px', animation:'fadeIn 0.4s ease-out' }}>
      <div style={{ fontSize:48, marginBottom:16, animation:'float 3s ease-in-out infinite' }}>üåä</div>
      <h3 style={{ fontFamily:'var(--font-display)', fontSize:18, color:'var(--text-primary)', marginBottom:8 }}>Track Your Cravings</h3>
      <p style={{ fontSize:13, color:'var(--text-secondary)', lineHeight:1.6, maxWidth:280, margin:'0 auto 24px' }}>
        Log when cravings hit, what triggers them, and how you respond. Over time you will see your own patterns clearly.
      </p>
      <button onClick={onOpenLog} style={{ padding:'14px 32px', borderRadius:40, border:'none', cursor:'pointer', fontSize:14, fontWeight:700, fontFamily:'var(--font-body)', background:'linear-gradient(135deg, #a3e635, #65a30d)', color:'#0a0f0a' }}>Log First Craving</button>
    </div>
  );

  const nextAch = CRAVING_ACHIEVEMENTS.find(a => a.count > stats.total);
  return (
    <div style={{ animation:'fadeIn 0.3s ease-out' }}>
      <div style={{ display:'grid', gridTemplateColumns:'1fr 1fr 1fr', gap:8, marginBottom:16 }}>
        {[
          { label:'Surfed', value:`${stats.surfedRate}%`, color:'#a3e635' },
          { label:'Avg This Week', value:stats.weekAvgIntensity || '-', color:'var(--amber)' },
          { label:'This Week', value:stats.thisWeek, color:'var(--teal)' }
        ].map((s, i) => (
          <div key={i} style={{ textAlign:'center', padding:'14px 8px', borderRadius:'var(--radius-md)', background:'var(--bg-card)', border:'1px solid var(--border-subtle)' }}>
            <div style={{ fontSize:22, fontWeight:700, color:s.color, letterSpacing:-0.5 }}>{s.value}</div>
            <div style={{ fontSize:9, color:'var(--text-muted)', fontWeight:600, marginTop:3, textTransform:'uppercase', letterSpacing:0.5 }}>{s.label}</div>
          </div>
        ))}
      </div>
      {stats.topTriggers.length > 0 && (
        <div style={{ padding:'14px 16px', borderRadius:'var(--radius-md)', marginBottom:16, background:'var(--bg-card)', border:'1px solid var(--border-subtle)' }}>
          <div style={{ fontSize:10, color:'var(--text-muted)', fontWeight:700, letterSpacing:0.5, textTransform:'uppercase', marginBottom:10 }}>Top Triggers</div>
          <div style={{ display:'flex', gap:8 }}>
            {stats.topTriggers.map(([tid, count]) => {
              const t = CRAVING_TRIGGERS.find(tr => tr.id === tid);
              if (!t) return null;
              return (
                <div key={tid} style={{ flex:1, textAlign:'center', padding:'10px 6px', borderRadius:'var(--radius-sm)', background:'rgba(255,255,255,0.03)' }}>
                  <div style={{ fontSize:18, marginBottom:4 }}>{t.icon}</div>
                  <div style={{ fontSize:11, fontWeight:600, color:'var(--text-primary)' }}>{t.label}</div>
                  <div style={{ fontSize:10, color:'var(--text-muted)' }}>{count}x</div>
                </div>
              );
            })}
          </div>
        </div>
      )}
      {nextAch && (
        <div style={{ padding:'12px 16px', borderRadius:'var(--radius-md)', marginBottom:16, background:'linear-gradient(135deg, rgba(163,230,53,0.04), rgba(163,230,53,0.02))', border:'1px solid var(--border-medium)', display:'flex', alignItems:'center', gap:12 }}>
          <div style={{ fontSize:24, animation:'float 3s ease-in-out infinite' }}>üåä</div>
          <div style={{ flex:1 }}>
            <div style={{ fontSize:10, color:'#a3e635', fontWeight:700, letterSpacing:0.5, textTransform:'uppercase' }}>Next: {nextAch.label}</div>
            <div style={{ fontSize:12, color:'var(--text-secondary)' }}>{nextAch.count - stats.total} more to go</div>
          </div>
          <div style={{ fontSize:11, fontWeight:800, color:'#a3e635', background:'rgba(163,230,53,0.08)', padding:'4px 10px', borderRadius:12 }}>{stats.total}/{nextAch.count}</div>
        </div>
      )}
      <button onClick={onOpenLog} style={{ width:'100%', padding:'14px', borderRadius:'var(--radius-md)', border:'1px solid var(--border-medium)', cursor:'pointer', fontSize:14, fontWeight:700, fontFamily:'var(--font-body)', background:'rgba(163,230,53,0.06)', color:'#a3e635', display:'flex', alignItems:'center', justifyContent:'center', gap:8, marginBottom:16, transition:'all 0.2s' }}>+ Log Craving</button>
      <div style={{ fontSize:10, color:'var(--text-muted)', fontWeight:700, letterSpacing:0.5, textTransform:'uppercase', marginBottom:10 }}>Recent ({stats.total} total)</div>
      <div style={{ display:'flex', flexDirection:'column', gap:6 }}>
        {cravings.slice(0, 15).map(c => {
          const trigIcons = (c.triggers || []).map(tid => { const t = CRAVING_TRIGGERS.find(tr => tr.id === tid); return t ? t.icon : ''; }).join(' ');
          return (
            <div key={c.id} style={{ padding:'12px 14px', borderRadius:'var(--radius-md)', background:'var(--bg-card)', border:'1px solid var(--border-subtle)', display:'flex', alignItems:'center', gap:12 }}>
              <div style={{ width:36, height:36, borderRadius:'50%', flexShrink:0, display:'flex', alignItems:'center', justifyContent:'center', fontSize:16, fontWeight:800, fontFamily:'var(--font-display)', color: c.intensity <= 3 ? '#a3e635' : c.intensity <= 6 ? '#fbbf24' : '#fb7185', background: c.intensity <= 3 ? 'rgba(163,230,53,0.1)' : c.intensity <= 6 ? 'rgba(251,191,36,0.1)' : 'rgba(251,113,133,0.1)' }}>{c.intensity}</div>
              <div style={{ flex:1, minWidth:0 }}>
                <div style={{ display:'flex', alignItems:'center', gap:6 }}>
                  <span style={{ fontSize:12, fontWeight:600, color:'var(--text-primary)' }}>{c.outcome === 'surfed' ? '\uD83C\uDF0A Surfed' : '\uD83D\uDCDD Slipped'}</span>
                  {c.usedBreathing && <span style={{ fontSize:9, color:'var(--teal)', fontWeight:700, background:'rgba(45,212,191,0.1)', padding:'2px 6px', borderRadius:8 }}>4-4-6</span>}
                </div>
                <div style={{ fontSize:11, color:'var(--text-muted)', marginTop:2 }}>
                  {trigIcons && <span style={{ marginRight:6 }}>{trigIcons}</span>}
                  {c.note && <span style={{ fontStyle:'italic' }}>{c.note.substring(0, 40)}{c.note.length > 40 ? '...' : ''}</span>}
                </div>
              </div>
              <div style={{ fontSize:10, color:'var(--text-muted)', flexShrink:0 }}>{formatRelativeTime(c.timestamp)}</div>
            </div>
          );
        })}
      </div>
    </div>
  );
}

function Onboarding({ onComplete }) {
  const [step, setStep] = useState(0);

  const slides = [
    {
      icon: "\uD83C\uDF3F",
      title: "Your brain heals fast",
      body: "CB1 receptors begin recovering within 48 hours. By day 28, PET scans show receptor density indistinguishable from people who never used cannabis.",
      source: "Hirvonen et al., Molecular Psychiatry 2012"
    },
    {
      icon: "\uD83E\uDDE0",
      title: "Progress is front-loaded",
      body: "The biggest neurological changes happen in the first weeks. Clear Mind uses clinically weighted scoring so your progress reflects reality, not just time.",
      source: "D'Souza et al., Biological Psychiatry 2016"
    },
    {
      icon: "\uD83D\uDD12",
      title: "Private by design",
      body: "Everything stays on your device. No accounts. No servers. No tracking. Clear your browser data to erase everything. Your recovery is nobody's business but yours.",
      source: ""
    }
  ];

  return (
    <div style={{
      minHeight:'100vh', minHeight:'100dvh', display:'flex', flexDirection:'column',
      alignItems:'center', justifyContent:'center', padding:24,
      background:'var(--bg-deep)'
    }}>
      <div style={{ maxWidth:360, width:'100%', textAlign:'center', animation:'fadeIn 0.6s ease-out' }}>
        <div key={step} style={{ animation:'scaleIn 0.4s var(--ease-spring)' }}>
          <div style={{ fontSize:56, marginBottom:24, animation:'float 3s ease-in-out infinite' }}>
            {slides[step].icon}
          </div>
          <h2 style={{
            fontFamily:'var(--font-display)', fontSize:26, color:'var(--text-primary)',
            marginBottom:12, lineHeight:1.2
          }}>
            {slides[step].title}
          </h2>
          <p style={{ fontSize:15, color:'var(--text-secondary)', lineHeight:1.6, marginBottom:8 }}>
            {slides[step].body}
          </p>
          {slides[step].source && (
            <p style={{ fontSize:11, color:'var(--text-muted)', fontStyle:'italic' }}>
              {slides[step].source}
            </p>
          )}
        </div>

        <div style={{ display:'flex', gap:6, justifyContent:'center', margin:'32px 0' }}>
          {slides.map((_, i) => (
            <div key={i} style={{
              width: i === step ? 24 : 8, height:8, borderRadius:4,
              background: i === step ? 'var(--green-primary)' : 'rgba(255,255,255,0.1)',
              transition:'all 0.3s var(--ease-out)'
            }} />
          ))}
        </div>

        <button onClick={() => {
          if (step < slides.length - 1) setStep(step + 1);
          else { Store.setOnboarded(); onComplete(); }
        }} style={{
          width:'100%', padding:'16px', borderRadius:40, border:'none', cursor:'pointer',
          fontSize:16, fontWeight:700, fontFamily:'var(--font-body)',
          background: step === slides.length - 1 ? 'linear-gradient(135deg, #a3e635, #65a30d)' : 'rgba(255,255,255,0.06)',
          color: step === slides.length - 1 ? '#0a0f0a' : 'var(--text-primary)',
          transition:'all 0.3s'
        }}>
          {step === slides.length - 1 ? "Let's Begin" : 'Next'}
        </button>

        {step < slides.length - 1 && (
          <button onClick={() => { Store.setOnboarded(); onComplete(); }} style={{
            background:'none', border:'none', color:'var(--text-muted)', fontSize:13,
            cursor:'pointer', fontFamily:'var(--font-body)', marginTop:16, padding:8
          }}>Skip</button>
        )}
      </div>
    </div>
  );
}


// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// SETUP SCREEN
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function SetupScreen({ onSave }) {
  const [quitDate, setQuitDate] = useState('');
  const [quitTime, setQuitTime] = useState('');
  const [dailySpend, setDailySpend] = useState('');
  const [method, setMethod] = useState('smoked');
  const ready = quitDate && quitTime;

  const handleSave = () => {
    if (!ready) return;
    const config = { quitDate: quitDate + 'T' + quitTime, dailySpend: parseFloat(dailySpend) || 0, method };
    Store.save(config);
    onSave(config);
  };

  const inputStyle = {
    width:'100%', padding:'14px 16px', borderRadius:'var(--radius-md)',
    background:'rgba(255,255,255,0.04)', border:'1px solid var(--border-medium)',
    color:'var(--text-primary)', fontSize:16, outline:'none', fontFamily:'var(--font-body)',
    transition:'border-color 0.2s'
  };
  const labelStyle = { fontSize:12, color:'var(--text-secondary)', fontWeight:600, marginBottom:6, display:'block', letterSpacing:0.3, textTransform:'uppercase' };

  return (
    <div style={{
      minHeight:'100vh', minHeight:'100dvh', display:'flex', flexDirection:'column',
      alignItems:'center', justifyContent:'center', padding:24,
      animation:'fadeIn 0.5s ease-out'
    }}>
      <div style={{ maxWidth:380, width:'100%' }}>
        <div style={{ textAlign:'center', marginBottom:40 }}>
          <div style={{ fontSize:48, marginBottom:16, animation:'float 3s ease-in-out infinite' }}>{"\uD83C\uDF3F"}</div>
          <h1 style={{
            fontFamily:'var(--font-display)', fontSize:32, letterSpacing:-0.5,
            background:'linear-gradient(135deg, #a3e635, #22c55e)',
            WebkitBackgroundClip:'text', WebkitTextFillColor:'transparent', marginBottom:8
          }}>Clear Mind</h1>
          <p style={{ color:'var(--text-muted)', fontSize:14, lineHeight:1.5 }}>
            Track your brain's recovery from the first hour forward
          </p>
        </div>

        <div style={{ display:'flex', flexDirection:'column', gap:20 }}>
          <div>
            <label style={labelStyle}>When did you quit?</label>
            <div style={{ display:'flex', gap:8 }}>
              <input type="date" value={quitDate} onChange={e => setQuitDate(e.target.value)} style={{ ...inputStyle, flex:1.2 }} />
              <input type="time" value={quitTime} onChange={e => setQuitTime(e.target.value)} style={{ ...inputStyle, flex:0.8 }} />
            </div>
          </div>

          <div>
            <label style={labelStyle}>Daily spend on cannabis ($)</label>
            <input type="number" placeholder="e.g. 15" value={dailySpend}
              onChange={e => setDailySpend(e.target.value)} style={inputStyle} />
          </div>

          <div>
            <label style={labelStyle}>Primary method</label>
            <div style={{ display:'flex', gap:8 }}>
              {['smoked','vaped','edibles','mixed'].map(m => (
                <button key={m} onClick={() => setMethod(m)} style={{
                  flex:1, padding:'12px 4px', borderRadius:'var(--radius-md)',
                  border: method===m ? '1px solid var(--green-primary)' : '1px solid var(--border-subtle)',
                  background: method===m ? 'rgba(163,230,53,0.08)' : 'transparent',
                  color: method===m ? 'var(--green-primary)' : 'var(--text-muted)',
                  fontSize:12, fontWeight:600, cursor:'pointer', fontFamily:'var(--font-body)',
                  textTransform:'capitalize', transition:'all 0.2s'
                }}>{m}</button>
              ))}
            </div>
          </div>

          <div style={{
            padding:'12px 16px', borderRadius:'var(--radius-md)',
            background:'rgba(255,255,255,0.02)', border:'1px solid var(--border-subtle)'
          }}>
            <p style={{ fontSize:11, color:'var(--text-muted)', lineHeight:1.5 }}>
              {"\uD83D\uDD12"} Privacy first. All data stays on your device. No accounts, no servers, no tracking.
            </p>
          </div>

          <button onClick={handleSave} disabled={!ready} style={{
            width:'100%', padding:'16px', borderRadius:40, border:'none', cursor: ready ? 'pointer' : 'default',
            fontSize:16, fontWeight:700, fontFamily:'var(--font-body)', marginTop:4,
            background: !ready ? 'rgba(255,255,255,0.04)' : 'linear-gradient(135deg, #a3e635, #65a30d)',
            color: !ready ? 'rgba(255,255,255,0.15)' : '#0a0f0a',
            transition:'all 0.3s'
          }}>Begin Tracking</button>
        </div>
      </div>
    </div>
  );
}


// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// CATEGORY DETAIL MODAL
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function DetailModal({ category, elapsed, onClose }) {
  if (!category) return null;
  const { progress } = getCategoryProgress(category, elapsed);

  return (
    <div onClick={onClose} style={{
      position:'fixed', inset:0, background:'rgba(0,0,0,0.85)', zIndex:100,
      display:'flex', alignItems:'flex-end', justifyContent:'center',
      backdropFilter:'blur(12px)', animation:'fadeIn 0.2s ease-out'
    }}>
      <div onClick={e => e.stopPropagation()} style={{
        background:'var(--bg-card)', borderRadius:'var(--radius-xl) var(--radius-xl) 0 0',
        padding:'28px 24px 40px', width:'100%', maxWidth:440, maxHeight:'80vh',
        overflowY:'auto', animation:'slideUp 0.3s var(--ease-out)'
      }}>
        <div style={{ display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:24 }}>
          <h3 style={{ fontFamily:'var(--font-display)', fontSize:22, color:category.color }}>
            {category.icon} {category.label}
          </h3>
          <button onClick={onClose} style={{
            background:'rgba(255,255,255,0.06)', border:'none', color:'var(--text-secondary)',
            width:36, height:36, borderRadius:'50%', cursor:'pointer', fontSize:18
          }}>√ó</button>
        </div>

        <div style={{ display:'flex', justifyContent:'center', marginBottom:24 }}>
          <ProgressRing progress={progress} color={category.color} size={120} strokeWidth={8}>
            <span style={{ fontSize:26, fontWeight:800, color:category.color }}>{Math.round(progress)}%</span>
          </ProgressRing>
        </div>

        <div style={{ display:'flex', flexDirection:'column', gap:8 }}>
          {category.milestones.map((m, i) => {
            const unlocked = elapsed >= m.time;
            const isCurrent = unlocked && (i === category.milestones.length - 1 || elapsed < category.milestones[i+1]?.time);
            return (
              <div key={i} style={{
                display:'flex', alignItems:'flex-start', gap:12, padding:'12px 14px',
                background: isCurrent ? 'rgba(255,255,255,0.04)' : 'transparent',
                borderRadius:'var(--radius-md)',
                border: isCurrent ? `1px solid ${category.color}22` : '1px solid transparent',
                transition:'all 0.2s'
              }}>
                <div style={{
                  width:10, height:10, borderRadius:'50%', flexShrink:0, marginTop:4,
                  background: unlocked ? category.color : 'rgba(255,255,255,0.08)',
                  boxShadow: isCurrent ? `0 0 10px ${category.color}55` : 'none',
                  transition:'all 0.3s'
                }} />
                <div style={{ flex:1 }}>
                  <div style={{ fontSize:13, fontWeight:600, color: unlocked ? 'var(--text-primary)' : 'rgba(255,255,255,0.2)' }}>{m.label}</div>
                  <div style={{ fontSize:11, color:'var(--text-muted)' }}>{formatTime(m.time)}</div>
                  {isCurrent && m.tip && (
                    <div style={{ fontSize:12, color:`${category.color}bb`, marginTop:6, lineHeight:1.5, fontStyle:'italic' }}>{m.tip}</div>
                  )}
                </div>
                <span style={{ fontSize:11, fontWeight:700, color: unlocked ? category.color : 'rgba(255,255,255,0.1)', flexShrink:0 }}>
                  {unlocked ? '\u2713' : formatTime(Math.max(0, m.time - elapsed))}
                </span>
              </div>
            );
          })}
        </div>
      </div>
    </div>
  );
}


// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// SETTINGS MODAL
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function SettingsModal({ config, onSave, onReset, onClose }) {
  const [qd, setQd] = useState(config.quitDate ? new Date(config.quitDate).toISOString().slice(0,10) : '');
  const [qt, setQt] = useState(config.quitDate ? new Date(config.quitDate).toTimeString().slice(0,5) : '');
  const [ds, setDs] = useState(String(config.dailySpend || ''));
  const [method, setMethod] = useState(config.method || 'smoked');
  const [confirmReset, setConfirmReset] = useState(false);

  const inputStyle = {
    width:'100%', padding:'14px 16px', borderRadius:'var(--radius-md)',
    background:'rgba(255,255,255,0.04)', border:'1px solid var(--border-medium)',
    color:'var(--text-primary)', fontSize:16, outline:'none', fontFamily:'var(--font-body)'
  };
  const labelStyle = { fontSize:12, color:'var(--text-secondary)', fontWeight:600, marginBottom:6, display:'block', letterSpacing:0.3, textTransform:'uppercase' };

  const handleSave = () => {
    if (!qd || !qt) return;
    onSave({ quitDate: qd + 'T' + qt, dailySpend: parseFloat(ds) || 0, method });
    onClose();
  };

  return (
    <div onClick={onClose} style={{
      position:'fixed', inset:0, background:'rgba(0,0,0,0.85)', zIndex:100,
      display:'flex', alignItems:'flex-end', justifyContent:'center',
      backdropFilter:'blur(12px)'
    }}>
      <div onClick={e => e.stopPropagation()} style={{
        background:'var(--bg-card)', borderRadius:'var(--radius-xl) var(--radius-xl) 0 0',
        padding:'28px 24px 40px', width:'100%', maxWidth:440, maxHeight:'85vh',
        overflowY:'auto', animation:'slideUp 0.3s var(--ease-out)'
      }}>
        <div style={{ display:'flex', justifyContent:'space-between', alignItems:'center', marginBottom:24 }}>
          <h3 style={{ fontFamily:'var(--font-display)', fontSize:22, color:'var(--text-primary)' }}>Settings</h3>
          <button onClick={onClose} style={{
            background:'rgba(255,255,255,0.06)', border:'none', color:'var(--text-secondary)',
            width:36, height:36, borderRadius:'50%', cursor:'pointer', fontSize:18
          }}>√ó</button>
        </div>

        <div style={{ display:'flex', flexDirection:'column', gap:20 }}>
          <div>
            <label style={labelStyle}>Quit Date</label>
            <div style={{ display:'flex', gap:8 }}>
              <input type="date" value={qd} onChange={e => setQd(e.target.value)} style={{ ...inputStyle, flex:1.2 }} />
              <input type="time" value={qt} onChange={e => setQt(e.target.value)} style={{ ...inputStyle, flex:0.8 }} />
            </div>
          </div>

          <div>
            <label style={labelStyle}>Daily Spend ($)</label>
            <input type="number" placeholder="e.g. 15" value={ds} onChange={e => setDs(e.target.value)} style={inputStyle} />
          </div>

          <div>
            <label style={labelStyle}>Primary Method</label>
            <div style={{ display:'flex', gap:8 }}>
              {['smoked','vaped','edibles','mixed'].map(m => (
                <button key={m} onClick={() => setMethod(m)} style={{
                  flex:1, padding:'12px 4px', borderRadius:'var(--radius-md)',
                  border: method===m ? '1px solid var(--green-primary)' : '1px solid var(--border-subtle)',
                  background: method===m ? 'rgba(163,230,53,0.08)' : 'transparent',
                  color: method===m ? 'var(--green-primary)' : 'var(--text-muted)',
                  fontSize:12, fontWeight:600, cursor:'pointer', fontFamily:'var(--font-body)',
                  textTransform:'capitalize', transition:'all 0.2s'
                }}>{m}</button>
              ))}
            </div>
          </div>

          <div style={{
            padding:'12px 16px', borderRadius:'var(--radius-md)',
            background:'rgba(255,255,255,0.02)', border:'1px solid var(--border-subtle)'
          }}>
            <p style={{ fontSize:11, color:'var(--text-muted)', lineHeight:1.5 }}>
              {"\uD83D\uDD12"} Your data stays on this device only. Nothing is sent to any server.
            </p>
          </div>

          <button onClick={handleSave} style={{
            width:'100%', padding:'16px', borderRadius:40, border:'none', cursor:'pointer',
            fontSize:16, fontWeight:700, fontFamily:'var(--font-body)',
            background:'linear-gradient(135deg, #a3e635, #65a30d)', color:'#0a0f0a'
          }}>Save Changes</button>

          <div style={{ borderTop:'1px solid var(--border-subtle)', marginTop:8, paddingTop:20 }}>
            {!confirmReset ? (
              <button onClick={() => setConfirmReset(true)} style={{
                width:'100%', padding:'12px', borderRadius:'var(--radius-md)',
                border:'1px solid rgba(244,63,94,0.2)', background:'transparent',
                color:'var(--rose)', fontSize:13, cursor:'pointer', fontFamily:'var(--font-body)'
              }}>Reset All Data</button>
            ) : (
              <div style={{ textAlign:'center' }}>
                <p style={{ color:'var(--rose)', fontSize:13, marginBottom:10 }}>This will erase everything. Are you sure?</p>
                <div style={{ display:'flex', gap:8 }}>
                  <button onClick={() => setConfirmReset(false)} style={{
                    flex:1, padding:'12px', borderRadius:'var(--radius-md)',
                    border:'1px solid var(--border-subtle)', background:'transparent',
                    color:'var(--text-secondary)', fontSize:13, cursor:'pointer', fontFamily:'var(--font-body)'
                  }}>Cancel</button>
                  <button onClick={onReset} style={{
                    flex:1, padding:'12px', borderRadius:'var(--radius-md)', border:'none',
                    background:'var(--rose)', color:'#fff', fontSize:13, cursor:'pointer',
                    fontWeight:700, fontFamily:'var(--font-body)'
                  }}>Erase Everything</button>
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
    </div>
  );
}


// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// HEALTH RING CARD
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function HealthRingCard({ category, elapsed, onClick, delay = 0 }) {
  const { progress, currentLabel } = getCategoryProgress(category, elapsed);
  return (
    <div onClick={onClick} style={{
      background:'var(--bg-card)', borderRadius:'var(--radius-lg)', padding:'18px 12px',
      display:'flex', flexDirection:'column', alignItems:'center', cursor:'pointer',
      border:'1px solid var(--border-subtle)', transition:'all 0.25s var(--ease-out)',
      animation:`slideUp 0.5s var(--ease-out) ${delay}ms both`
    }}>
      <ProgressRing progress={progress} color={category.color} size={80} strokeWidth={6}>
        <span style={{ fontSize:22 }}>{category.icon}</span>
        <span style={{ fontSize:10, fontWeight:700, color:category.color }}>{Math.round(progress)}%</span>
      </ProgressRing>
      <span style={{ fontSize:12, fontWeight:600, marginTop:10, color:'var(--text-primary)', textAlign:'center' }}>{category.label}</span>
      <span style={{
        fontSize:10, color:'var(--text-muted)', textAlign:'center', marginTop:3,
        lineHeight:1.3, display:'-webkit-box', WebkitLineClamp:2, WebkitBoxOrient:'vertical', overflow:'hidden'
      }}>{currentLabel}</span>
    </div>
  );
}


// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// ACHIEVEMENT BADGE
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function AchievementBadge({ ach, unlocked, isNew }) {
  return (
    <div className={isNew && unlocked ? 'milestone-new' : ''} style={{
      display:'flex', flexDirection:'column', alignItems:'center', gap:6,
      opacity: unlocked ? 1 : 0.2, transition:'opacity 0.5s', position:'relative'
    }}>
      {isNew && unlocked && (
        <div style={{
          position:'absolute', top:-2, right:-2, background:'var(--green-primary)', color:'var(--bg-deep)',
          fontSize:7, fontWeight:800, padding:'2px 5px', borderRadius:6, zIndex:2, letterSpacing:0.5
        }}>NEW</div>
      )}
      <div style={{
        width:48, height:48, borderRadius:'50%', display:'flex', alignItems:'center', justifyContent:'center',
        fontSize:22, background: unlocked ? 'var(--bg-card)' : 'rgba(255,255,255,0.02)',
        border: unlocked ? '2px solid rgba(255,255,255,0.1)' : '2px solid rgba(255,255,255,0.03)',
        boxShadow: unlocked && isNew ? '0 0 16px rgba(163,230,53,0.25)' : 'none',
        transition:'all 0.3s'
      }}>
        {unlocked ? ach.icon : "\uD83D\uDD12"}
      </div>
      <span style={{ fontSize:9, color: unlocked ? 'var(--text-secondary)' : 'rgba(255,255,255,0.15)', textAlign:'center', maxWidth:60, lineHeight:1.2 }}>{ach.label}</span>
      <span style={{ fontSize:8, color:'var(--text-muted)' }}>{formatTime(ach.time)}</span>
    </div>
  );
}


// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// MAIN DASHBOARD
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function Dashboard({ config, onUpdateConfig, onReset }) {
  const [now, setNow] = useState(Date.now());
  const [activeTab, setActiveTab] = useState('health');
  const [detailCat, setDetailCat] = useState(null);
  const [showSettings, setShowSettings] = useState(false);
  const [showBreathing, setShowBreathing] = useState(false);
  const [showCravingLog, setShowCravingLog] = useState(false);
  const [prefillBreathing, setPrefillBreathing] = useState(false);
  const [showConfetti, setShowConfetti] = useState(false);
  const [newAchievement, setNewAchievement] = useState(null);
  const prevUnlockedRef = useRef(0);

  useEffect(() => { const t = setInterval(() => setNow(Date.now()), 1000); return () => clearInterval(t); }, []);

  const elapsed = getElapsed(config.quitDate);
  const moneySaved = ((elapsed / D) * config.dailySpend).toFixed(2);
  const daysClean = Math.floor(elapsed / D);
  const overallHealth = getWeightedHealth(elapsed);
  const unlockedAchs = ACHIEVEMENTS.filter(a => elapsed >= a.time);
  const unlockedCount = unlockedAchs.length;
  const latestUnlocked = [...ACHIEVEMENTS].reverse().find(a => elapsed >= a.time);
  const nextAch = ACHIEVEMENTS.find(a => elapsed < a.time);
  const motivation = getDailyMotivation(elapsed);
  const tip = getContextualTip(elapsed);
  const phase = getPhase(elapsed);
  const seenAchs = Store.getSeen();

  useEffect(() => {
    if (unlockedCount > prevUnlockedRef.current && prevUnlockedRef.current > 0) {
      const newest = unlockedAchs[unlockedAchs.length - 1];
      if (!seenAchs.includes(newest.label)) {
        setNewAchievement(newest);
        setShowConfetti(true);
        Store.markSeen(newest.label);
        setTimeout(() => { setShowConfetti(false); setNewAchievement(null); }, 4500);
      }
    }
    prevUnlockedRef.current = unlockedCount;
  }, [unlockedCount]);

  const tabStyle = (active) => ({
    flex:1, padding:'12px 0', textAlign:'center', fontSize:11, fontWeight:700,
    color: active ? 'var(--green-primary)' : 'var(--text-muted)', cursor:'pointer',
    transition:'all 0.2s', letterSpacing:0.8, textTransform:'uppercase',
    background:'none', border:'none', borderBottom: active ? '2px solid var(--green-primary)' : '2px solid transparent',
    fontFamily:'var(--font-body)'
  });

  return (
    <div style={{ minHeight:'100vh', minHeight:'100dvh', maxWidth:440, margin:'0 auto', position:'relative' }}>
      <Confetti active={showConfetti} />

      {/* Achievement Toast */}
      {newAchievement && (
        <div style={{
          position:'fixed', top:20, left:'50%', transform:'translateX(-50%)', zIndex:150,
          padding:'16px 24px', borderRadius:'var(--radius-lg)',
          background:'linear-gradient(135deg, rgba(163,230,53,0.12), rgba(34,197,94,0.08))',
          border:'1px solid var(--border-accent)', backdropFilter:'blur(16px)',
          display:'flex', alignItems:'center', gap:14, animation:'slideDown 0.5s var(--ease-spring)',
          maxWidth:380, boxShadow:'0 8px 32px rgba(0,0,0,0.4)'
        }}>
          <span style={{ fontSize:36 }}>{newAchievement.icon}</span>
          <div>
            <div style={{ fontSize:10, color:'var(--green-primary)', fontWeight:700, letterSpacing:1, textTransform:'uppercase' }}>Achievement Unlocked</div>
            <div style={{ fontSize:15, fontWeight:700, color:'var(--text-primary)', marginTop:2 }}>{newAchievement.label}</div>
          </div>
        </div>
      )}

      {/* Header */}
      <div style={{ padding:'20px 20px 0', display:'flex', justifyContent:'space-between', alignItems:'center' }}>
        <h1 style={{
          fontFamily:'var(--font-display)', fontSize:22, letterSpacing:-0.3,
          background:'linear-gradient(135deg, #a3e635, #22c55e)',
          WebkitBackgroundClip:'text', WebkitTextFillColor:'transparent'
        }}>Clear Mind</h1>
        <div style={{ display:'flex', gap:8 }}>
          {/* Emergency Breathing Button */}
          <button onClick={() => setShowBreathing(true)} style={{
            background:'rgba(244,63,94,0.08)', border:'1px solid rgba(244,63,94,0.15)',
            color:'var(--rose)', width:36, height:36, borderRadius:'50%', cursor:'pointer',
            fontSize:16, display:'flex', alignItems:'center', justifyContent:'center',
            transition:'all 0.2s'
          }} title="Craving? Breathe.">{"\uD83C\uDF2C\uFE0F"}</button>
          <button onClick={() => setShowSettings(true)} style={{
            background:'rgba(255,255,255,0.04)', border:'1px solid var(--border-subtle)',
            color:'var(--text-muted)', width:36, height:36, borderRadius:'50%', cursor:'pointer', fontSize:16
          }}>{"\u2699"}</button>
        </div>
      </div>

      {/* Main Ring */}
      <div style={{ display:'flex', flexDirection:'column', alignItems:'center', padding:'28px 0 12px' }}>
        <ProgressRing progress={overallHealth} color="var(--green-primary)" size={160} strokeWidth={10}>
          <span style={{ fontSize:38, fontWeight:300, color:'var(--green-primary)', fontFamily:'var(--font-display)' }}>
            {overallHealth.toFixed(1)}
          </span>
          <span style={{ fontSize:10, color:'var(--text-muted)', fontWeight:600, letterSpacing:1.5, textTransform:'uppercase', marginTop:2 }}>
            Recovery
          </span>
        </ProgressRing>
        <div style={{ marginTop:14, fontSize:24, fontWeight:300, color:'var(--text-primary)', fontFamily:'var(--font-display)', letterSpacing:-0.5 }}>
          {formatDuration(elapsed)}
        </div>
        <div style={{ fontSize:11, color:'var(--text-muted)', marginTop:2 }}>cannabis-free</div>
      </div>

      {/* Stats Row */}
      <div style={{ display:'flex', gap:8, padding:'8px 20px', justifyContent:'center' }}>
        {[
          { label:'Saved', value:`$${moneySaved}`, color:'var(--teal)' },
          { label:'Days', value:daysClean.toLocaleString(), color:'var(--green-primary)' },
          { label:'Milestones', value:`${unlockedCount}/${ACHIEVEMENTS.length}`, color:'var(--amber)' }
        ].map((s, i) => (
          <div key={i} style={{
            flex:1, textAlign:'center', padding:'14px 8px', borderRadius:'var(--radius-md)',
            background:'var(--bg-card)', border:'1px solid var(--border-subtle)',
            animation:`slideUp 0.5s var(--ease-out) ${i*80}ms both`
          }}>
            <div style={{ fontSize:18, fontWeight:700, color:s.color, letterSpacing:-0.5 }}>{s.value}</div>
            <div style={{ fontSize:9, color:'var(--text-muted)', fontWeight:600, marginTop:3, textTransform:'uppercase', letterSpacing:0.5 }}>{s.label}</div>
          </div>
        ))}
      </div>

      {/* Motivational Quote */}
      <div style={{
        margin:'8px 20px', padding:'14px 18px', borderRadius:'var(--radius-md)',
        background:'linear-gradient(135deg, rgba(163,230,53,0.04), rgba(34,197,94,0.02))',
        borderLeft:'3px solid var(--green-primary)'
      }}>
        <p style={{ fontSize:13, color:'var(--text-secondary)', lineHeight:1.6, fontStyle:'italic', fontFamily:'var(--font-display)' }}>
          "{motivation}"
        </p>
      </div>

      {/* Contextual Tip */}
      <div style={{
        margin:'4px 20px 8px', padding:'10px 14px', borderRadius:'var(--radius-md)',
        background:'rgba(255,255,255,0.02)', border:'1px solid var(--border-subtle)'
      }}>
        <p style={{ fontSize:11, color:'var(--text-muted)', lineHeight:1.5 }}>{tip}</p>
      </div>

      {/* Next Achievement */}
      {nextAch && (
        <div style={{
          margin:'4px 20px', padding:'14px 18px', borderRadius:'var(--radius-md)',
          background:'var(--bg-card)', border:'1px solid var(--border-medium)',
          display:'flex', alignItems:'center', gap:14
        }}>
          <span style={{ fontSize:28, animation:'float 3s ease-in-out infinite' }}>{nextAch.icon}</span>
          <div style={{ flex:1 }}>
            <div style={{ fontSize:10, color:'var(--green-primary)', fontWeight:700, letterSpacing:0.5, textTransform:'uppercase' }}>Next</div>
            <div style={{ fontSize:14, fontWeight:600, color:'var(--text-primary)' }}>{nextAch.label}</div>
            <div style={{ fontSize:11, color:'var(--text-muted)' }}>
              {nextAch.time - elapsed > 0 ? `in ${formatDuration(nextAch.time - elapsed)}` : 'Almost there...'}
            </div>
          </div>
          <div style={{
            width:42, height:42, borderRadius:'50%', display:'flex', alignItems:'center', justifyContent:'center',
            background:'rgba(163,230,53,0.06)', border:'1px solid var(--border-medium)',
            fontSize:11, fontWeight:800, color:'var(--green-primary)'
          }}>{Math.min(100, Math.round((elapsed / nextAch.time) * 100))}%</div>
        </div>
      )}

      {/* Tabs */}
      <div style={{ display:'flex', margin:'20px 20px 0', gap:0 }}>
        <button style={tabStyle(activeTab === 'health')} onClick={() => setActiveTab('health')}>Recovery</button>
        <button style={tabStyle(activeTab === 'badges')} onClick={() => setActiveTab('badges')}>Milestones</button>
        <button style={tabStyle(activeTab === 'cravings')} onClick={() => setActiveTab('cravings')}>Cravings</button>
      </div>

      {/* Tab Content */}
      <div style={{ padding:'16px 20px 120px' }}>
        {activeTab === 'health' && (
          <div style={{ display:'grid', gridTemplateColumns:'1fr 1fr 1fr', gap:10 }}>
            {HEALTH_CATEGORIES.map((cat, i) => (
              <HealthRingCard key={cat.id} category={cat} elapsed={elapsed} onClick={() => setDetailCat(cat)} delay={i * 60} />
            ))}
          </div>
        )}

        {activeTab === 'badges' && (
          <>
            {latestUnlocked && (
              <div style={{
                padding:24, borderRadius:'var(--radius-lg)', marginBottom:16, textAlign:'center',
                background:'linear-gradient(135deg, rgba(163,230,53,0.06), rgba(163,230,53,0.02))',
                border:'1px solid var(--border-medium)', animation:'scaleIn 0.4s var(--ease-spring)'
              }}>
                <span style={{ fontSize:44 }}>{latestUnlocked.icon}</span>
                <div style={{ fontFamily:'var(--font-display)', fontSize:18, color:'var(--green-primary)', marginTop:10 }}>{latestUnlocked.label}</div>
                <div style={{ fontSize:13, color:'var(--text-secondary)', marginTop:6, lineHeight:1.5 }}>{latestUnlocked.desc}</div>
              </div>
            )}
            <div style={{ display:'grid', gridTemplateColumns:'repeat(4, 1fr)', gap:14 }}>
              {ACHIEVEMENTS.map((ach, i) => {
                const unlocked = elapsed >= ach.time;
                const isNew = unlocked && !seenAchs.includes(ach.label);
                return <AchievementBadge key={i} ach={ach} unlocked={unlocked} isNew={isNew} />;
              })}
            </div>
          </>
        )}

        {activeTab === 'cravings' && <CravingsTab onOpenLog={() => { setPrefillBreathing(false); setShowCravingLog(true); }} />}

      </div>

      {/* Modals */}
      <DetailModal category={detailCat} elapsed={elapsed} onClose={() => setDetailCat(null)} />
      {showSettings && (
        <SettingsModal config={config}
          onSave={c => { Store.save(c); onUpdateConfig(c); }}
          onReset={onReset} onClose={() => setShowSettings(false)} />
      )}
      {showBreathing && <BreathingExercise onClose={() => setShowBreathing(false)} onLogCraving={(fromBreathing) => { setPrefillBreathing(fromBreathing); setShowCravingLog(true); }} />}
      {showCravingLog && <CravingLogModal onClose={() => setShowCravingLog(false)} prefillBreathing={prefillBreathing} onSave={(entry) => { CravingStore.add(entry); }} />}

    </div>
  );
}


// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
// APP ROOT
// ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function App() {
  const [config, setConfig] = useState(() => Store.get());
  const [showOnboarding, setShowOnboarding] = useState(() => !Store.hasOnboarded() && !Store.get());

  const handleSetup = (c) => { Store.save(c); setConfig(c); };
  const handleUpdate = (c) => { Store.save(c); setConfig(c); };
  const handleReset = () => {
    Store.clear();
    localStorage.removeItem('clearmind_seen');
    CravingStore.clear();
    localStorage.removeItem('clearmind_onboarded');
    setConfig(null);
    setShowOnboarding(true);
  };

  if (showOnboarding) return <Onboarding onComplete={() => setShowOnboarding(false)} />;
  if (!config || !config.quitDate) return <SetupScreen onSave={handleSetup} />;
  return <Dashboard config={config} onUpdateConfig={handleUpdate} onReset={handleReset} />;
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
if ('serviceWorker' in navigator) { navigator.serviceWorker.register('/sw.js').catch(() => {}); }
</script>
</body>
</html>
